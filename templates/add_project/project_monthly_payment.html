{% extends 'add_project/base.html' %} {% block title %} Project Management - Add
Project Monthly Payment {% endblock title %} {% block content %}

<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h4>Add Project Details</h4>
  </div>

  <div class="container py-4">
    <div class="row justify-content-md-left">
      <div class="col-md-12">
        <h5>Payment Details</h5>
        <div class="mb-3">
          <select
            onchange="myFunction('{{ add_project.id }}')"
            id="reference"
            class="form-select form-select-lg mb-3"
            name="month_name"
          >
            <option selected="" disabled>Select Method</option>
            {% for t in type %}
            <option value="{{ t.name }}">{{ t.name }}</option>
            {% endfor %}
          </select>
        </div>

        <hr />
        <br />

        <script type="text/javascript">
          function myFunction(project_id) {
            let selected = document.getElementById("reference").value;

            if (selected === "Monthly Wise") {
              window.location.href =
                "/add_project/payment/type/monthly/" + project_id;
            } else if (selected === "Features Wise") {
              window.location.href =
                "/add_project/payment/type/feature/" + project_id;
            }
          }
        </script>

        <div class="" id="month">
          <h4>Monthly Wise Payment</h4>
          <div class="mt-3">
            <button type="button" class="btn btn-primary add_month_field">
              Add Month Table
            </button>
          </div>

          <div class="container1">
            <div class="forDelete">
              <div class="row pt-3">
                <div class="col-md-3 mt-5 pb-3">
                  <input
                    class="form-control"
                    style="width: 250px"
                    type="text"
                    name="month"
                    placeholder="Month Name"
                    required
                  />
                </div>
                <div class="col-md-9 mt-5 pb-3">
                  <button
                    onclick="deleteMonth(this)"
                    type="button"
                    class="btn btn-danger btn-sm mt-1"
                  >
                    Delete Month
                  </button>
                </div>

                <div class="row">
                    <div class="col-md-5">
                      <select class="form-select form-select-md" name="designation">
                        <option selected="" disabled>
                          Select Developer's Designation
                        </option>
                        {% for t in teams %}
                        <option value="{{ t.designation }}">
                          {{ t.designation }}
                        </option>
                        {% endfor %}
                      </select>
                    </div>
                    <div class="col-md-5">
                      <input
                        class="form-control"
                        type="number"
                        name="salary"
                        placeholder="Developer's Salary"
                        required
                      />
                    </div>
                </div>

              <div class="row pt-3">
                <div class="col-md-5">
                  <select class="form-select form-select-md" name="designation">
                    <option selected="" disabled>
                      Select Developer's Designation
                    </option>
                    {% for t in teams %}
                    <option value="{{ t.designation }}">
                      {{ t.designation }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-5">
                  <input
                    class="form-control"
                    type="number"
                    name="salary"
                    placeholder="Developer's Salary"
                    required
                  />
                </div>
                <div class="col-md-2">
                  <button
                    type="button"
                    onclick="deleteRow(this)"
                    class="btn btn-danger"
                    style="border-radius: 25px; margin-top: 2px"
                  >
                    Delete
                  </button>
                </div>
              </div>
              <div class="row pt-3">
                <div class="col-md-5">
                  <select class="form-select form-select-md" name="designation">
                    <option selected="" disabled>
                      Select Developer's Designation
                    </option>
                    {% for t in teams %}
                    <option value="{{ t.designation }}">
                      {{ t.designation }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-5">
                  <input
                    class="form-control"
                    type="number"
                    name="salary"
                    placeholder="Developer's Salary"
                    required
                  />
                </div>
                <div class="col-md-2">
                  <button
                    type="button"
                    onclick="deleteRow(this)"
                    class="btn btn-danger"
                    style="border-radius: 25px; margin-top: 2px"
                  >
                    Delete
                  </button>
                </div>
              </div>

              <div class="row pt-3">
                <div class="col-md-5">
                  <select class="form-select form-select-md" name="designation">
                    <option selected="" disabled>
                      Select Developer's Designation
                    </option>
                    {% for t in teams %}
                    <option value="{{ t.designation }}">
                      {{ t.designation }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
                <div class="col-md-5">
                  <input
                    class="form-control"
                    type="number"
                    name="salary"
                    placeholder="Developer's Salary"
                    required
                  />
                </div>
                <div class="col-md-2">
                  <button
                    type="button"
                    onclick="deleteRow(this)"
                    class="btn btn-danger"
                    style="border-radius: 25px; margin-top: 2px"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

          
          
        <div class="text-center mt-5">
          <a
            href="{% url 'role-management' pid=add_project.id %}"
            class="btn btn-danger btn-style"
            >Back To Role Management</a
          >
          <button
            onClick="save_payment_info('{{ add_project.id }}')"
            type="submit"
            class="btn btn-success ml-2 btn-style"
          >
            Submit Payment
          </button>
        </div>
      </div>
    </div>
  </div>
  </div>
</main>

<script>
    let x = 2;
    $(document).ready(function () {
      let max_fields = 10;
      let wrapper = $(".container1");
      let add_button = $(".add_month_field");

      $(add_button).click(function (e) {
        e.preventDefault();
        if (x < max_fields) {
          $(wrapper).append(
            '<div class="forDelete">' +
              '<div class="row pt-3">' +
              '<div class="col-md-3 mt-5 pb-3">' +
              '<input class="form-control" style="width: 250px;" type="text" placeholder="Month Name" name="month" required>' +
              "</div>" +
              '<div class="col-md-9 mt-5 pb-3">' +
              '<button onclick="deleteMonth(this)" type="button" class="btn btn-danger btn-sm mt-1">Delete Month</button>' +
              "</div>" +
              '<div class="col-md-5">' +
              '<select class="form-select form-select-md" name="designation">' +
              '<option selected="" disabled>Select Developer\'s Designation</option>' +
              "{% for t in teams %}" +
              '<option value="{{ t.designation }}">{{ t.designation }}</option>' +
              "{% endfor %}" +
              "</select>" +
              "</div>" +
              '<div class="col-md-5">' +
              '<input class="form-control" type="number" name="salary" placeholder="Developer\'s Salary" required>' +
              "</div>" +
              "</div>" +
              '<div class="row pt-3">' +
              '<div class="col-md-5">' +
              '<select class="form-select form-select-md" name="designation">' +
              '<option selected="" disabled>Select Developer\'s Designation</option>' +
              "{% for t in teams %}" +
              '<option value="{{ t.designation }}">{{ t.designation }}</option>' +
              "{% endfor %}" +
              "</select>" +
              "</div>" +
              '<div class="col-md-5">' +
              '<input class="form-control" type="number" name="salary" placeholder="Developer\'s Salary" required>' +
              "</div>" +
              '<div class="col-md-2">' +
              '<button type="button" onclick="deleteRow(this)" class="btn btn-danger" style="border-radius: 25px;margin-top:2px;">Delete</button>' +
              "</div>" +
              "</div>" +
              '<div class="row pt-3">' +
              '<div class="col-md-5">' +
              '<select class="form-select form-select-md" name="designation">' +
              '<option selected="" disabled>Select Developer\'s Designation</option>' +
              "{% for t in teams %}" +
              '<option value="{{ t.designation }}">{{ t.designation }}</option>' +
              "{% endfor %}" +
              "</select>" +
              "</div>" +
              '<div class="col-md-5">' +
              '<input class="form-control" type="number" name="salary" placeholder="Developer\'s Salary" required>' +
              "</div>" +
              '<div class="col-md-2">' +
              '<button type="button" onclick="deleteRow(this)" class="btn btn-danger" style="border-radius: 25px;margin-top:2px;" >Delete</button>' +
              "</div>" +
              "</div>" +
              '<div class="row pt-3">' +
              '<div class="col-md-5">' +
              '<select class="form-select form-select-md" name="designation">' +
              '<option selected="" disabled>Select Developer\'s Designation</option>' +
              "{% for t in teams %}" +
              '<option value="{{ t.designation }}">{{ t.designation }}</option>' +
              "{% endfor %}" +
              "</select>" +
              "</div>" +
              '<div class="col-md-5">' +
              '<input class="form-control" type="number" name="salary" placeholder="Developer\'s Salary" required>' +
              "</div>" +
              '<div class="col-md-2">' +
              '<button type="button" onclick="deleteRow(this)" class="btn btn-danger" style="border-radius: 25px;margin-top:2px;" >Delete</button>' +
              "</div>" +
              "</div>" +
              "</div>"
          );
          ++x;
        } else {
          alert("You Reached the limits");
        }
      });
    });

    function deleteMonth(btn) {
      let month = btn.parentNode.parentNode.parentNode;
      let parent = month.parentNode;
      parent.removeChild(month);
      ``;
      x--;
    }

    function deleteRow(btn) {
      let row = btn.parentNode.parentNode;
      let parent = row.parentNode;
      parent.removeChild(row);
    }

    function save_payment_info(project_id) {
      let month = document.getElementsByName("month");
      let designation = document.getElementsByName("designation");
      let salary = document.getElementsByName("salary");

      const total_data = parseInt(designation.length/month.length);
      
      let output = [];
      
      
      for (let i = 0; i < month.length; i++) {
        let count = 0
        let j = 0
        let instance = {};
        let feature = []
        instance.month = month[i].value;

        while (count < total_data) {
            feature.push({
                designation: designation[j].value,
                price: salary[j].value,
            });
            count++;
            j++;
        }
        instance.feature = feature;

        output.push(instance);
      }


        let postUrl = "/add_project/payment/type/monthly/" + project_id;

        $.ajax({
          type: "POST",
          url: postUrl,
          data: {
            values: JSON.stringify(output),
            csrfmiddlewaretoken: "{{csrf_token}}",
          },
          datatype: "json",
          success: function (data) {
            window.location.href =
              "/add_project/payment/service/" + project_id;
          },
        });
    }
  </script>
{% endblock content %}
